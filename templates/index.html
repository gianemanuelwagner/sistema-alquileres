{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Alquileres{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="page-title">
                    <i class="bi bi-speedometer2 me-2"></i>
                    Dashboard
                </h1>
                <p class="page-subtitle">Resumen general del sistema de administración de alquileres</p>
            </div>
            <div class="col-auto">
                <div class="btn-group">
                    <button class="btn btn-outline-primary btn-print" data-bs-toggle="tooltip" title="Imprimir reporte">
                        <i class="bi bi-printer"></i>
                    </button>
                    <button class="btn btn-outline-primary btn-export" data-bs-toggle="tooltip" title="Exportar datos">
                        <i class="bi bi-download"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stats-number">{{ total_propiedades }}</div>
                        <div class="stats-label">Total Propiedades</div>
                    </div>
                                         <div class="stats-icon">
                         <i class="bi bi-house-door"></i>
                     </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card success">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stats-number">{{ propiedades_disponibles }}</div>
                        <div class="stats-label">Propiedades Disponibles</div>
                    </div>
                    <div class="stats-icon">
                        <i class="bi bi-house-check"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card info">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stats-number">{{ total_inquilinos }}</div>
                        <div class="stats-label">Total Inquilinos</div>
                    </div>
                    <div class="stats-icon">
                        <i class="bi bi-people"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card warning">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stats-number">{{ contratos_activos }}</div>
                        <div class="stats-label">Contratos Activos</div>
                    </div>
                    <div class="stats-icon">
                        <i class="bi bi-file-earmark-check"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-lightning me-2"></i>
                        Acciones Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('nueva_propiedad') }}" class="btn btn-primary w-100">
                                <i class="bi bi-plus-circle me-2"></i>
                                Nueva Propiedad
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('nuevo_inquilino') }}" class="btn btn-success w-100">
                                <i class="bi bi-person-plus me-2"></i>
                                Nuevo Inquilino
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('nuevo_contrato') }}" class="btn btn-info w-100">
                                <i class="bi bi-file-earmark-plus me-2"></i>
                                Nuevo Contrato
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('propiedades') }}" class="btn btn-outline-primary w-100">
                                <i class="bi bi-search me-2"></i>
                                Ver Propiedades
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <!-- Recent Properties -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                                         <h5 class="mb-0">
                         <i class="bi bi-house-door me-2"></i>
                         Propiedades Recientes
                     </h5>
                    <a href="{{ url_for('propiedades') }}" class="btn btn-sm btn-outline-primary">
                        Ver Todas
                    </a>
                </div>
                <div class="card-body">
                    {% if propiedades_recientes %}
                        {% for propiedad in propiedades_recientes %}
                        <div class="recent-item">
                            <div class="recent-item-title">{{ propiedad.direccion }}</div>
                            <div class="recent-item-subtitle">
                                {{ propiedad.tipo }} - {{ propiedad.habitaciones }} hab. - {{ propiedad.baños }} baños
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="recent-item-meta">
                                    <span class="badge bg-{{ 'success' if propiedad.estado == 'disponible' else 'warning' }}">
                                        {{ propiedad.estado.title() }}
                                    </span>
                                    <span class="ms-2">${{ "%.2f"|format(propiedad.precio) }}</span>
                                </div>
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ url_for('editar_propiedad', id=propiedad.id) }}" 
                                       class="btn btn-outline-primary btn-sm" 
                                       data-bs-toggle="tooltip" title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="{{ url_for('propiedades') }}" 
                                       class="btn btn-outline-info btn-sm" 
                                       data-bs-toggle="tooltip" title="Ver detalles">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                                                 <div class="text-center text-muted py-4">
                             <i class="bi bi-house-door display-4"></i>
                             <p class="mt-3">No hay propiedades registradas</p>
                            <a href="{{ url_for('nueva_propiedad') }}" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-2"></i>
                                Agregar Primera Propiedad
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recent Contracts -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark-text me-2"></i>
                        Contratos Recientes
                    </h5>
                    <a href="{{ url_for('contratos') }}" class="btn btn-sm btn-outline-primary">
                        Ver Todos
                    </a>
                </div>
                <div class="card-body">
                    {% if contratos_recientes %}
                        {% for contrato in contratos_recientes %}
                        <div class="recent-item">
                            <div class="recent-item-title">{{ contrato.direccion }}</div>
                            <div class="recent-item-subtitle">
                                {{ contrato.nombre }} {{ contrato.apellido }} - ${{ "%.2f"|format(contrato.precio_mensual) }}/mes
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="recent-item-meta">
                                    <span class="badge bg-{{ 'success' if contrato.estado == 'activo' else 'secondary' }}">
                                        {{ contrato.estado.title() }}
                                    </span>
                                    <span class="ms-2">{{ contrato.fecha_inicio }}</span>
                                </div>
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ url_for('editar_contrato', id=contrato.id) }}" 
                                       class="btn btn-outline-primary btn-sm" 
                                       data-bs-toggle="tooltip" title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="{{ url_for('contratos') }}" 
                                       class="btn btn-outline-info btn-sm" 
                                       data-bs-toggle="tooltip" title="Ver detalles">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-file-earmark-text display-4"></i>
                            <p class="mt-3">No hay contratos registrados</p>
                            <a href="{{ url_for('nuevo_contrato') }}" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-2"></i>
                                Crear Primer Contrato
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- User Package Info -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-box me-2"></i>
                        Mi Paquete: {{ user_info.paquete_nombre }}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6 class="text-muted">Propiedades</h6>
                                <div class="progress mb-2" style="height: 8px;">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ (total_propiedades / user_info.max_propiedades * 100) | round(1) }}%"></div>
                                </div>
                                <small class="text-muted">{{ total_propiedades }} / {{ user_info.max_propiedades }}</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6 class="text-muted">Inquilinos</h6>
                                <div class="progress mb-2" style="height: 8px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         style="width: {{ (total_inquilinos / user_info.max_inquilinos * 100) | round(1) }}%"></div>
                                </div>
                                <small class="text-muted">{{ total_inquilinos }} / {{ user_info.max_inquilinos }}</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6 class="text-muted">Contratos</h6>
                                <div class="progress mb-2" style="height: 8px;">
                                    <div class="progress-bar bg-info" role="progressbar" 
                                         style="width: {{ (contratos_activos / user_info.max_contratos * 100) | round(1) }}%"></div>
                                </div>
                                <small class="text-muted">{{ contratos_activos }} / {{ user_info.max_contratos }}</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6 class="text-muted">Precio</h6>
                                <h5 class="text-primary mb-0">
                                    {% if user_info.paquete_precio > 0 %}
                                        ${{ "%.2f"|format(user_info.paquete_precio) }}/mes
                                    {% else %}
                                        <span class="text-success">Gratis</span>
                                    {% endif %}
                                </h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Info -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        Información del Sistema
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                <span>Sistema funcionando correctamente</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-database-fill text-primary me-2"></i>
                                <span>Base de datos SQLite activa</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-shield-check text-success me-2"></i>
                                <span>Seguridad activada</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-clock-fill text-info me-2"></i>
                                <span>Última actualización: <span id="last-update"></span></span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-gear-fill text-warning me-2"></i>
                                <span>Configuración por defecto</span>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-heart-fill text-danger me-2"></i>
                                <span>Desarrollado con Flask</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
